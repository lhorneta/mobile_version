!function(){"use strict";$(document).ready(function(){function t(){try{return localStorage.setItem("test","tested"),!!localStorage.getItem("test")}catch(t){return!1}}function a(){var t=[],a=[];console.log(localStorage);for(var e=0;e<localStorage.length;e++){var r=localStorage.key(e),i=r.indexOf("3gstar_"),o=localStorage.getItem(r),s="<strong>"+r+"</strong>  "+o+"<br/>";a.push(s),-1!==i&&t.push(r)}$("p.local_debug").html(null!==a?a:"empty");var n="";if($(".ordering .row.first-order").remove(),t.length>0){for(var e=0;e<t.length;e++){$(".feedback-form").show();var c=localStorage.getItem(t[e]),d=JSON.parse(c);console.log("data",d),p+=d[0].sum,n+="<div class = 'row first-order'><div class='col-xs-4'><img src="+d[0].image+" class='img-responsive'></div><div class='col-xs-6'> <h2>"+d[0].name+"</h2><div class='form-group' data-id="+d[0].id+" data-price="+d[0].price+"><input 								type='text'							value="+d[0].count+" 			class='checkout_shop'			></div><div class='price pr_cart'><p>"+d[0].sum+"<span>грн</span></p></div> </div> <div class='col-xs-2'><img src='img/close.png' class='img-responsive delete-item'></div></div> "}n+="<div class='price pr_cart'><p>Всего: "+p+" грн</p></div>"}else n="Ваша корзина пуста",$(".feedback-form").hide();$(".ordering").html(n),p=0}function e(t,a){var e=$(".message."+a);""!==t?e.show().html(t):e.hide()}function r(t,a){var r={Number:"Использовать только числа!",Required:"Это поле обязательно к заполнению",Name:"Необходимо вводить символы"},i=/[0-9]/,o=/[A-Za-zА-Яа-я]/,s={isNumber:function(t){return i.test(t)?($(".message").hide(),!0):(e(r.Number,"phone"),!1)},required:function(t){return""!==t?!0:(e(r.Required,"required"),!1)},isName:function(t){return o.test(t)?($(".message").hide(),!0):(e(r.Name,"name"),!1)}};switch(a){case"add_to_cart":s.isName(t),s.required(t);break;case"checkout":if(s.isName(t)&&s.required(t))return!0;break;case"required":if(s.required(t))return!0;break;case"recount":s.isNumber(t),s.required(t)}}function i(t){localStorage.removeItem(t),a()}function o(){localStorage.clear()}function s(){var t=c.val(),a=d.val(),e={name:t,phone:a};return r(t,"checkout")&&r(a,"required")?(u.removeAttr("disabled"),e):void u.attr("disabled","disabled")}function n(t,e,r){console.log("obj",t,e,r),$.ajax({url:"http://m.3gstar.com.ua/ajax/ajax.php",type:"post",data:{order:t,total:e,user:r},success:function(){alert("Ваш заказ оформлен"),o(),a()},error:function(t){console.log("error",t)}})}$(".message").hide();var c=$("input[name=input_name]"),d=($("input[name=input_product_phone]").mask("+38(999) 999 99 99"),$("input[name=input_phone]").mask("+38(999) 999 99 99")),l=($(".try30day-phone").mask("+38(999) 999 99 99"),[]),u=$(".btn-product").attr("disabled","disabled"),m=0,p=0;t()===!1?$(".popup").show():localStorage.removeItem("test"),$(".buy_button").on({click:function(){if(localStorage.length>0){var t=$(this).attr("data-id"),a=localStorage.getItem(t),e=JSON.parse(a);if(console.log("newdata",e),null!==e)var r={id:$(this).attr("data-id"),name:$(this).attr("data-name"),description:$(this).attr("data-description"),image:$(this).attr("data-image"),price:$(this).attr("data-price"),sum:$(this).attr("data-price")*(+$(this).attr("data-count")+1),count:+$(this).attr("data-count")+1,params:$(this).attr("data-params")};else var r={id:$(this).attr("data-id"),name:$(this).attr("data-name"),description:$(this).attr("data-description"),image:$(this).attr("data-image"),price:$(this).attr("data-price"),sum:$(this).attr("data-price")*$(this).attr("data-count"),count:$(this).attr("data-count"),params:$(this).attr("data-params")}}else var r={id:$(this).attr("data-id"),name:$(this).attr("data-name"),description:$(this).attr("data-description"),image:$(this).attr("data-image"),price:$(this).attr("data-price"),sum:$(this).attr("data-price")*$(this).attr("data-count"),count:$(this).attr("data-count"),params:$(this).attr("data-params")};l.push(r),localStorage.setItem(r.id,JSON.stringify(l)),console.log("localStorage",localStorage)}}),a(),$(document.body).on("keyup",".checkout_shop",function(){m++;var t=$(this).parents(".first-order"),e=$(this).val(),r=t.find(".form-group").attr("data-id"),i=t.find(".form-group").attr("data-price"),o=localStorage.getItem(r),s=JSON.parse(o),n=i*e;if(e>=1){var c={id:s[0].id,name:s[0].name,description:s[0].description,image:s[0].image,price:s[0].price,count:e,sum:n,params:s[0].params};1>=m?(l.push(c),localStorage.setItem(r,JSON.stringify(l))):localStorage.setItem(r,JSON.stringify([c])),a()}}),$(document.body).on("click",".delete-item",function(){var t=$(this).parents(".first-order"),a=t.find(".form-group").attr("data-id");i(a)}),$("input[name=input_name],input[name=input_phone]").change(function(){s()}),$(".btn-product").click(function(){var t=s(),a=[],e=[],r=[];if(localStorage.length>0){for(var i=0,o=0;o<localStorage.key(o);o++){var c=localStorage.getItem(localStorage.key(o)),d=JSON.parse(c);i+=d[0].sum,a.push(d)}e.push({total:i}),r.push({userName:t.name,userPhone:t.phone}),null!==a&&null!==e&&null!==t.name&&null!==t.phone&&n(a,e,r)}})})}();